<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MIDI Note Verification</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      margin-top: 50px;
    }
    #midiInput, #result {
      font-size: 1.5em;
      margin: 20px;
    }
  </style>
</head>
<body>
  <h1>MIDI Note Verification</h1>
  <p id="midiInput">Empfangene Note: –</p>
  <p id="result">Ergebnis: –</p>
  
  <script>
    // Erwartete Note und Oktave zur Überprüfung
    var expectedNote = "c";
    var expectedOctave = 4;
    
    // Funktion, um den MIDI-Notenwert (Data1) in einen Notennamen und eine Oktave umzuwandeln.
    function midiNoteToName(noteNumber) {
      var noteNames = ['c', 'c#', 'd', 'd#', 'e', 'f', 'f#', 'g', 'g#', 'a', 'a#', 'b'];
      var octave = Math.floor(noteNumber / 12) - 1;
      var noteName = noteNames[noteNumber % 12];
      return { note: noteName, octave: octave };
    }
    
    // Funktion, die den empfangenen MIDI-Notenwert (Data1) in eine Note umwandelt
    // und diese mit der erwarteten Note vergleicht.
    function verifyNote(noteNumber) {
      var midiInfo = midiNoteToName(noteNumber);
      
      // Ausgabe der empfangenen Note
      document.getElementById("midiInput").textContent =
        "Empfangene Note: " + midiInfo.note.toUpperCase() + " (Oktave " + midiInfo.octave + ")";
      
      // Überprüfung
      if(midiInfo.note === expectedNote && midiInfo.octave === expectedOctave) {
        document.getElementById("result").textContent = "Ergebnis: Richtig!";
      } else {
        document.getElementById("result").textContent =
          "Ergebnis: Falsch. Erwartet: " + expectedNote.toUpperCase() + " (Oktave " + expectedOctave + ")";
      }
    }
    
    // Globale Funktion, die von der nativen App aufgerufen wird (über evaluateJavaScript)
    window.handleMIDIMessage = function(status, data1, data2) {
      console.log("MIDI Message received: Status: " + status + " Data1: " + data1 + " Data2: " + data2);
      // Nur Note-On Nachrichten verarbeiten (Status 144 bis 159 und velocity > 0)
      if(status >= 144 && status < 160 && data2 > 0) {
        verifyNote(data1);
      }
    }
    
    // Test: Simuliere einen MIDI-Aufruf nach 2 Sekunden (Data1 = 60 entspricht mittlerem C)
    setTimeout(function() {
      window.handleMIDIMessage(144, 60, 100);
    }, 2000);
  </script>
</body>
</html>
