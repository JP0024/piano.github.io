<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Notentraining</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
    }
    #notation {
      width: 820px;
      transform: scale(2);
      margin: 0 auto;
      text-align: center;
    }
    .active-mode, .active-level, .active-range {
      opacity: 1;
      font-weight: bold;
      color: black;
    }
    .inactive-mode, .inactive-level, .inactive-range {
      opacity: 0.5;
    }
    #nativeLog {
      margin-top: 10px;
      font-size: 0.9em;
      color: gray;
    }
  </style>
</head>
<body>
  <!-- MIDI-Statusanzeige -->
  <div id="midiStatus" style="position: absolute; top: 10px; left: 10px; font-size: 1em;"></div>
  <!-- √úberschrift -->
  <h1>Notentraining</h1>
  <!-- Range-, Handmodus- und Level-Auswahl -->
  <div id="rangeSelector">
    <span id="range-c" style="cursor: pointer; font-size: 1.5em; margin: 5px;">C-Lage</span>
    <span id="range-d" style="cursor: pointer; font-size: 1.5em; margin: 5px;">D-Lage</span>
    <span id="range-f" style="cursor: pointer; font-size: 1.5em; margin: 5px;">F-Lage</span>
    <span id="range-g" style="cursor: pointer; font-size: 1.5em; margin: 5px;">G-Lage</span>
    <span id="range-mc" style="cursor: pointer; font-size: 1.5em; margin: 5px;">Mittlere C</span>
  </div>
  <br>
  <div id="modeSelector">
    <span id="mode-left" style="cursor: pointer; font-size: 2em; margin: 5px;">‚úã</span>
    <span id="mode-right" style="cursor: pointer; font-size: 2em; margin: 5px; display:inline-block; transform: scaleX(-1);">‚úã</span>
    <span id="mode-both" style="cursor: pointer; font-size: 2em; margin: 5px;">üôå</span>
  </div>
  <br>
  <div id="levelSelector">
    <span id="level-1" style="cursor: pointer; font-size: 2em; margin: 5px;">1Ô∏è‚É£</span>
    <span id="level-2" style="cursor: pointer; font-size: 2em; margin: 5px;">2Ô∏è‚É£</span>
    <span id="level-3" style="cursor: pointer; font-size: 2em; margin: 5px;">3Ô∏è‚É£</span>
    <span id="level-random" style="cursor: pointer; font-size: 2em; margin: 5px;">üéâ</span>
  </div>

  <div id="notation"></div>
  <div id="score">Score: 0%</div>
  <div id="responseTime">üèéÔ∏è -- ms</div>
  <div id="nativeLog"></div>

  <!-- VexFlow einbinden -->
  <script src="https://cdn.jsdelivr.net/npm/vexflow@4.2.2/build/cjs/vexflow.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Globale Zust√§nde
      let currentRange = "C";
      let selectedMode = "right";
      let level = 1;
      let seriesLength = 1;
      let currentSeries = [];
      let seriesCounter = 0;
      let noteStartTime = 0;
      let totalAttempts = 0;
      let correctAnswers = 0;

      const rangeNotes = {
        "C": ["c", "d", "e", "f", "g"],
        "D": ["d", "e", "f#", "g", "a"],
        "F": ["f", "g", "a", "bb", "c"],
        "G": ["g", "a", "b", "c", "d"],
        "MC": ["c", "d", "e", "f", "g"]
      };

      // --- Range-Auswahl ---
      const rangeC = document.getElementById("range-c");
      const rangeD = document.getElementById("range-d");
      const rangeF = document.getElementById("range-f");
      const rangeG = document.getElementById("range-g");
      const rangeMC = document.getElementById("range-mc");

      rangeC.addEventListener("click", function() {
        currentRange = "C";
        document.querySelector("h1").textContent = "C-Lage";
        setActiveRange("range-c");
        generateSeries();
      });
      rangeD.addEventListener("click", function() {
        currentRange = "D";
        document.querySelector("h1").textContent = "D-Lage";
        setActiveRange("range-d");
        generateSeries();
      });
      rangeF.addEventListener("click", function() {
        currentRange = "F";
        document.querySelector("h1").textContent = "F-Lage";
        setActiveRange("range-f");
        generateSeries();
      });
      rangeG.addEventListener("click", function() {
        currentRange = "G";
        document.querySelector("h1").textContent = "G-Lage";
        setActiveRange("range-g");
        generateSeries();
      });
      rangeMC.addEventListener("click", function() {
        currentRange = "MC";
        document.querySelector("h1").textContent = "Mittlere C-Lage";
        setActiveRange("range-mc");
        generateSeries();
      });

      function setActiveRange(activeId) {
        [rangeC, rangeD, rangeF, rangeG, rangeMC].forEach(function(elem) {
          elem.classList.remove("active-range");
          elem.classList.add("inactive-range");
        });
        document.getElementById(activeId).classList.remove("inactive-range");
        document.getElementById(activeId).classList.add("active-range");
      }
      setActiveRange("range-c");

      // --- Handmodus-Auswahl ---
      const modeLeft = document.getElementById("mode-left");
      const modeRight = document.getElementById("mode-right");
      const modeBoth = document.getElementById("mode-both");

      modeLeft.addEventListener("click", function() 
